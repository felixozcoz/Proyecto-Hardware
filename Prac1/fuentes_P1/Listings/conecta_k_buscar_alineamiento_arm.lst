


ARM Macro Assembler    Page 1 


    1 00000000                 AREA             codigo,CODE
    2 00000000         
    3 00000000                 EXPORT           conecta_K_buscar_alineamiento_a
rm
    4 00000000         
    5 00000000         conecta_K_buscar_alineamiento_arm
    6 00000000         ; PROLOGO
    7 00000000 E1A0C00D        MOV              IP, SP
    8 00000004 E92DDFFE        STMDB            SP!, {r1-r10,FP,IP,LR,PC}
    9 00000008 E24CB004        SUB              FP, IP, #4
   10 0000000C         ;-----------------------
   11 0000000C         
   12 0000000C         ; Se preservan intalterados los registros
   13 0000000C         ; destinados a los parámetros, r1-r3.
   14 0000000C         ; Se guarda tablero (r0) en r5
   15 0000000C E1A05000        MOV              r5, r0
   16 00000010         
   17 00000010         ; Desapilar Parámetros Deltas
   18 00000010 E59B6004        LDR              r6, [fp, #4] ; delta_fila
   19 00000014 E59B7008        LDR              r7, [fp, #8] ; delta_columna
   20 00000018         
   21 00000018 EB00000A        BL               tablero_buscar_color
   22 0000001C         
   23 0000001C E3500000        CMP              r0, #0      ; r0 == EXITO ?
   24 00000020 13A00000        MOVNE            r0, #0      ; NOT EQUAL: r0 = 0
                                                             y 
   25 00000024 1A000006        BNE              Epilogo     ; restaurar marco d
                                                            e pila anterior
   26 00000028         ; TRUE: sigue buscar_alineamiento()
   27 00000028         
   28 00000028         sigue_buscar_alineamiento
   29 00000028         
   30 00000028         ; Calcular fila y columna nueva
   31 00000028 E0811006        ADD              r1, r1, r6  ; fila + delta_fila
                                                            
   32 0000002C E0822007        ADD              r2, r2, r7  ; columna + delta_c
                                                            olumna
   33 00000030         
   34 00000030         ; Cargar deltas en pila
   35 00000030 E52D7004        STR              r7, [sp,#-4]! ; delta_columna
   36 00000034 E52D6004        STR              r6, [sp,#-4]! ; delta_fila
   37 00000038         
   38 00000038 E1A00005        MOV              r0, r5      ; restaurar tablero
                                                             a r0
   39 0000003C         
   40 0000003C EBFFFFFE        BL               conecta_K_buscar_alineamiento_a
rm
   41 00000040         
   42 00000040         ; La subrutina deveria guardar el valor devuelto en r0
   43 00000040         
   44 00000040 E2800001        ADD              r0,r0,#1    ; return 1 + ...
   45 00000044         
   46 00000044         Epilogo
   47 00000044         ; Epilogo
   48 00000044 E91BAFFE        LDMDB            FP, {r1-r10,FP,SP,PC}
   49 00000048         ;----------------
   50 00000048         
   51 00000048         tablero_buscar_color
   52 00000048         ; PROLOGO



ARM Macro Assembler    Page 2 


   53 00000048 E1A0C00D        MOV              IP, SP
   54 0000004C E92DDFF0        STMDB            SP!, {r4-r10,FP,IP,LR,PC}
   55 00000050 E24CB004        SUB              FP, IP, #4
   56 00000054         ;-----------------------
   57 00000054         
   58 00000054         ; Verificar condiciones de fila y columna
   59 00000054         ; sobre dimensiones de tablero
   60 00000054         
   61 00000054         ; fila < NUM_FILAS
   62 00000054 E3510007        CMP              r1, #7
   63 00000058 AA000015        BGE              tablero_buscar_color_ERROR
   64 0000005C         
   65 0000005C         ; columna < NUM_COLUMNAS
   66 0000005C E3520007        CMP              r2, #7
   67 00000060 AA000013        BGE              tablero_buscar_color_ERROR
   68 00000064         
   69 00000064         ; size_t col = 0
   70 00000064 E3A04000        MOV              r4, #0      ;
   71 00000068 E3A05006        MOV              r5, #6
   72 0000006C E0050591        MUL              r5, r1, r5  ; r5 = fila * 6
   73 00000070         
   74 00000070         tablero_buscar_color_FOR
   75 00000070         
   76 00000070         ; condición 1: col < MAX_NO_CERO 
   77 00000070 E3540006        CMP              r4, #6
   78 00000074 AA000006        BGE              loop_exit_col_igual_MAX_NO_CERO
   79 00000078         
   80 00000078         ; condición 2: ... && (t->columnas[fila][col] != columna
                       )
   81 00000078         ; ESTO ESTABA ANTES
   82 00000078         ;MOV r6, #6  
   83 00000078         ;MUL r5, r4, r1 ; r5 = fila * 6
   84 00000078         ;ADD r5,r5,r4 ; Desplazamiento de filas + col       r5 =
                        (fila * 6) + col
   85 00000078         ;ADD r5,r0,r5 ; &t + desplazamiento fila,col   r5 = t + 
                       (fila * 6 + col)    (== t.columnas[fila][col])
   86 00000078         ; HASTA AQUÍ
   87 00000078         ; calcular @ de la celda
   88 00000078 E0846005        ADD              r6, r4, r5
   89 0000007C E19070D6        LDRSB            r7, [r0, r6] ; r5 = t->columnas
                                                            [fila][col]
   90 00000080         
   91 00000080         ; t->columnas[fila][col] != columna ? col++ e iterar : s
                       alir bucle
   92 00000080 E1570002        CMP              r7, r2
   93 00000084 12844001        ADDNE            r4, r4, #1  ; col++
   94 00000088 1AFFFFF8        BNE              tablero_buscar_color_FOR 
                                                            ; iterar
   95 0000008C         
   96 0000008C         loop_exit
   97 0000008C         
   98 0000008C         ; col == MAX_NO_CERO ? ERROR : seguir bucle
   99 0000008C E3540006        CMP              r4, #6
  100 00000090 0A000007        BEQ              tablero_buscar_color_ERROR
  101 00000094         
  102 00000094         loop_exit_col_igual_MAX_NO_CERO
  103 00000094         
  104 00000094         ; r7 = t->no_ceros[fila][col]
  105 00000094 E3A0702A        MOV              r7, #42     ; r7 = NUM_FILAS * 



ARM Macro Assembler    Page 3 


                                                            MAX_NO_CERO
  106 00000098         
  107 00000098 E0867007        ADD              r7, r6, r7  ; r7 = r7 + @column
                                                            a[fila][col]
  108 0000009C E19070D7        LDRSB            r7, [r0, r7] ; r7 = @tablero + 
                                                            r7 = no_cero[fila][
                                                            col]  
  109 000000A0         
  110 000000A0         ; Esto estaba
  111 000000A0         ;MUL r6, r1, r7  ; Desplazamiento de fila en no_ceros
  112 000000A0         ;ADD r6, r6, r4  ; Desplazamiento de fila + col en no_ce
                       ros
  113 000000A0         ;ADD r6, r5, r6   ; desplazamiento a no_ceros + desplaza
                       miento fila y columna
  114 000000A0         ;ADD r6, r0, r6   ; &t + desplazamiento a no_ceros + des
                       plazamiento fila y columna
  115 000000A0         ;LDRB r6, [r6]    ; r6 = t->no_ceros[fila][col]
  116 000000A0 E2077003        AND              r7, r7, #0x03 ; celda_color(CEL
                                                            DA celda) {return (
                                                            celda & 0x03);}
  117 000000A4 E1570003        CMP              r7, r3      ; celda_color(t->no
                                                            _ceros[fila][col]) 
                                                            == color)
  118 000000A8 1A000001        BNE              tablero_buscar_color_ERROR
  119 000000AC         
  120 000000AC         tablero_buscar_color_EXITO
  121 000000AC E3A00000        MOV              r0,#0
  122 000000B0 EA000000        B                tablero_buscar_color_fin
  123 000000B4         
  124 000000B4         tablero_buscar_color_ERROR
  125 000000B4 E3E00000        MOV              r0, #-1
  126 000000B8         
  127 000000B8         tablero_buscar_color_fin
  128 000000B8         ; Epilogo
  129 000000B8 E91BAFF0        LDMDB            FP, {r4-r10,FP,SP,PC}
  130 000000BC         ;----------------
  131 000000BC         
  132 000000BC                 END
Command Line: --debug --xref --diag_suppress=9931 --apcs=interwork --depend=.\o
bjects\conecta_k_buscar_alineamiento_arm.d -o.\objects\conecta_k_buscar_alineam
iento_arm.o -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -IC:\Keil_
v5\ARM\INC\Philips --predefine="__EVAL SETA 1" --predefine="__UVISION_VERSION S
ETA 526" --list=.\listings\conecta_k_buscar_alineamiento_arm.lst conecta_K_busc
ar_alineamiento_arm.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

Epilogo 00000044

Symbol: Epilogo
   Definitions
      At line 46 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      At line 25 in file conecta_K_buscar_alineamiento_arm.s
Comment: Epilogo used once
codigo 00000000

Symbol: codigo
   Definitions
      At line 1 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      None
Comment: codigo unused
conecta_K_buscar_alineamiento_arm 00000000

Symbol: conecta_K_buscar_alineamiento_arm
   Definitions
      At line 5 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      At line 3 in file conecta_K_buscar_alineamiento_arm.s
      At line 40 in file conecta_K_buscar_alineamiento_arm.s

loop_exit 0000008C

Symbol: loop_exit
   Definitions
      At line 96 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      None
Comment: loop_exit unused
loop_exit_col_igual_MAX_NO_CERO 00000094

Symbol: loop_exit_col_igual_MAX_NO_CERO
   Definitions
      At line 102 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      At line 78 in file conecta_K_buscar_alineamiento_arm.s
Comment: loop_exit_col_igual_MAX_NO_CERO used once
sigue_buscar_alineamiento 00000028

Symbol: sigue_buscar_alineamiento
   Definitions
      At line 28 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      None
Comment: sigue_buscar_alineamiento unused
tablero_buscar_color 00000048

Symbol: tablero_buscar_color
   Definitions
      At line 51 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      At line 21 in file conecta_K_buscar_alineamiento_arm.s
Comment: tablero_buscar_color used once
tablero_buscar_color_ERROR 000000B4




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

Symbol: tablero_buscar_color_ERROR
   Definitions
      At line 124 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      At line 63 in file conecta_K_buscar_alineamiento_arm.s
      At line 67 in file conecta_K_buscar_alineamiento_arm.s
      At line 100 in file conecta_K_buscar_alineamiento_arm.s
      At line 118 in file conecta_K_buscar_alineamiento_arm.s

tablero_buscar_color_EXITO 000000AC

Symbol: tablero_buscar_color_EXITO
   Definitions
      At line 120 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      None
Comment: tablero_buscar_color_EXITO unused
tablero_buscar_color_FOR 00000070

Symbol: tablero_buscar_color_FOR
   Definitions
      At line 74 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      At line 94 in file conecta_K_buscar_alineamiento_arm.s
Comment: tablero_buscar_color_FOR used once
tablero_buscar_color_fin 000000B8

Symbol: tablero_buscar_color_fin
   Definitions
      At line 127 in file conecta_K_buscar_alineamiento_arm.s
   Uses
      At line 122 in file conecta_K_buscar_alineamiento_arm.s
Comment: tablero_buscar_color_fin used once
11 symbols
343 symbols in table
